{% extends "layout.html" %}

{% block title %}
    Banzuke
{% endblock %}

{% block main %}
    <h2>Banzuke</h2>
    <script>
        const bashos = {{ bashos | tojson }};
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const select = document.getElementById('basho-select');

        // Populate the dropdown with city + month/year
        bashos.forEach(basho => {
            const option = document.createElement('option');
            option.value = `${basho.start_month}-${basho.start_year}`;
            option.textContent = `${basho.name} ${basho.city} (${basho.start_month}/${basho.start_year})`;
            select.appendChild(option);
        });

        // Handle selection changes
        select.addEventListener('change', () => {
            if (!select.value) return;  // no selection
            const [month, year] = select.value.split('-');

            fetch(`/banzuke/${month}/${year}`)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    const tbody = document.querySelector('#banzuke-table tbody');
                    tbody.innerHTML = '';  // clear previous rows

                    for (let rank in data) {
                        let slots = data[rank];
                        slots.forEach(slot => {
                            const row = document.createElement('tr');

                            const eastCell = document.createElement('td');
                            eastCell.textContent = slot.EAST.name;
                            row.appendChild(eastCell);

                            const rankCell = document.createElement('td');
                            rankCell.textContent = slot.rank_name;
                            row.appendChild(rankCell);

                            const westCell = document.createElement('td');
                            westCell.textContent = slot.WEST.name;
                            row.appendChild(westCell);

                            tbody.appendChild(row);
                        });
                    }
                })
                .catch(error => console.error('Error fetching data:', error));
        });
    });
    </script>

    <div class="container mt-3">
    <div class="row">
        <div class="col-md-4">
            <label for="basho-select" class="form-label">Choose a Tournament</label>
            <select id="basho-select" class="form-select">
                <option value="">-- Select Tournament --</option>
            </select>
        </div>
    </div>
</div>

<div class="table-responsive mt-3">
    <table id="banzuke-table" class="table table-striped table-bordered table-hover table-sm">
        <thead class="table-dark">
            <tr>
                <th>East</th>
                <th>Rank</th>
                <th>West</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
{% endblock %}
